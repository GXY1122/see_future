@startuml
title Chainlink Data Feeds - 链上即期外汇价格组件图

!theme vibrant
skinparam {
  shadowing false
  defaultFontName Monospace
  roundCorner 10
  componentStyle uml2
  componentSpacing 28
  nodePadding 16
  ArrowThickness 1.4
}
left to right direction

' ----------- 系统边界 -----------
node "Off-Chain (链下)" {
  component "FX Market Data\n(Bank / ECN / Broker)" as FXSources
  component "Data Aggregator\n(Enterprise Feeds)" as Vendors

  component "Chainlink DON" as DON {
    component "OCR Job Runner" as OCRJob
    component "Adapter / Parser" as Parser
    component "Signer" as Signer
  }
}

node "On-Chain (链上)" {
  component "OCR2 Aggregator\n(Feed Contract)" as Aggregator
  component "Feed Registry" as Registry
  component "Access Control\n(Owner / Deployer)" as ACL
  component "Consumer DApp" as DApp
  component "DeFi Protocol" as DeFi
}

' ----------- 数据采集 -----------
FXSources ..> Vendors : (1) 提供原始报价
Vendors ..> OCRJob : (2) 聚合/清洗
OCRJob --> Parser : (3) 提取结构化数据
OCRJob --> Signer : (4) 结果签名

' ----------- 链下共识与上链 -----------
DON --> Aggregator : (5) OCR 报告\n(spot FX rate)
Aggregator --> Registry : (6) 注册/更新数据源
ACL --> Aggregator : (0) 权限配置

' ----------- 链上消费 -----------
DApp ..> Registry : (7) 查询交易对
DApp --> Aggregator : (8) latestAnswer()
DeFi --> Aggregator : (9) latestRoundData()

note right of Aggregator
  - 触发条件: 偏差阈值/心跳
  - 输出: FX spot rate (e.g. USD/CNY)
end note

note left of DON
  - 多节点共识降低单点风险
  - OCR 降低 gas 成本
end note

@enduml
